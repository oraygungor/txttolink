<!-- ... <head> kısmı değişmedi ... -->
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <!-- ... HTML’in geri kalanı aynı ... -->

  <script>
    /* == SEÇİM ve DRAG&DROP ============================================= */
    const fileInput        = document.getElementById('fileInput');
    const fileNameDisplay  = document.getElementById('fileName');
    const resultsContainer = document.getElementById('resultsContainer');
    const linkList         = document.getElementById('linkList');
    const linkCount        = document.getElementById('linkCount');
    const copyAllButton    = document.getElementById('copyAllButton');

    fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

    const dropZone = document.querySelector('label[for="fileInput"]');
    ['dragover','dragleave'].forEach(evt =>
      dropZone.addEventListener(evt, e => {
        e.preventDefault();
        dropZone.classList.toggle('bg-blue-50', evt === 'dragover');
        dropZone.classList.toggle('border-blue-400', evt === 'dragover');
      })
    );
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    /* == DOSYAYI OKU ==================================================== */
    function handleFile(file) {
      resetUI();
      fileNameDisplay.textContent = `Seçilen dosya: ${file.name}`;
      const reader = new FileReader();
      reader.onload  = e => extractLinks(e.target.result);
      reader.onerror = () => alert('Dosya okunurken bir hata oluştu.');
      reader.readAsText(file);
    }

    /* == LİNKLERİ AYIKLA ================================================= */
    function extractLinks(textContent) {
      /* 1- HTML olarak ayrıştır */
      const parser = new DOMParser();
      const doc    = parser.parseFromString(textContent, 'text/html');

      /* 2- <a href="..."> linklerini topla */
      const anchorHrefs = [...doc.querySelectorAll('a[href]')]
                          .map(a => a.getAttribute('href'));

      /* 3- Çıplak URL’leri (http… / www…) yakala */
      const urlRegex = /((?:https?|ftp):\/\/[^\s"'<>]+|www\.[^\s"'<>]+)/gi;
      const plainURLs = [...textContent.matchAll(urlRegex)].map(m => m[0]);

      /* 4- Birleştir & tekilleştir */
      const allLinks = [...new Set([...anchorHrefs, ...plainURLs]
                        .filter(Boolean))];

      /* 5- Sonucu ekrana bas */
      linkCount.textContent = allLinks.length;
      resultsContainer.classList.remove('hidden');

      if (!allLinks.length) {
        linkList.innerHTML =
          '<li class="p-4 text-center text-gray-500">Bu dosyada geçerli bir link bulunamadı.</li>';
        return;
      }

      allLinks.forEach(href => {
        const url = href.startsWith('http') ? href : `http://${href}`;
        const li  = document.createElement('li');
        li.className = 'p-3 flex items-center justify-between hover:bg-gray-50';
        li.innerHTML = `
          <a href="${url}"
             target="_blank"
             rel="noopener noreferrer"
             class="text-blue-600 hover:underline truncate"
             title="${url}">
             ${url}
          </a>
          <button class="copy-btn ml-4 px-2 py-1 text-xs font-medium
                         text-gray-600 bg-gray-200 rounded hover:bg-gray-300"
                  data-link="${url}">
            Kopyala
          </button>`;
        linkList.appendChild(li);
      });

      /* 6- Kopyala butonlarını aktif et */
      document.querySelectorAll('.copy-btn').forEach(btn =>
        btn.addEventListener('click', e =>
          copyToClipboard(e.target.dataset.link, e.target)
        )
      );
    }

    /* == TOPLU / TEKİL KOPYALAMA ======================================== */
    copyAllButton.addEventListener('click', () => {
      const allLinks = [...linkList.querySelectorAll('a')].map(a => a.href).join('\n');
      if (allLinks) copyToClipboard(allLinks, copyAllButton, true);
    });

    function copyToClipboard(text, btn, isAll=false) {
      const tmp = document.createElement('textarea');
      tmp.value = text;
      tmp.style.position = 'fixed';
      document.body.appendChild(tmp);
      tmp.focus();
      tmp.select();
      try {
        document.execCommand('copy');
        btn.textContent = 'Kopyalandı!';
        btn.classList.add('bg-green-500','text-white');
      } catch { btn.textContent = 'Hata!'; }
      document.body.removeChild(tmp);
      setTimeout(() => {
        btn.textContent = isAll ? 'Tümünü Kopyala' : 'Kopyala';
        btn.classList.remove('bg-green-500','text-white');
      }, 2000);
    }

    /* == ARAYÜZ SIFIRLA ================================================== */
    function resetUI() {
      resultsContainer.classList.add('hidden');
      linkList.innerHTML = '';
      linkCount.textContent = '0';
    }
  </script>
</body>
</html>
